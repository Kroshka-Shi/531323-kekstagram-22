(()=>{"use strict";const e=e=>"Escape"===e.key,t=e=>{const t=e.value;return parseInt(t)};let r={};const o=()=>r,n=/^#[^\W_]{1,19}$/,c="effects__preview--",s="border--error",a=["gif","jpg","jpeg","png"],i={CHROME:{range:{min:0,max:1},step:.1,start:1},SEPIA:{range:{min:0,max:1},step:.1,start:1},MARVIN:{range:{min:0,max:100},step:1,start:100},PHOBOS:{range:{min:0,max:3},step:.1,start:3},HEAT:{range:{min:1,max:3},step:.1,start:3}},l={CHROME:"grayscale",SEPIA:"sepia",MARVIN:"invert",PHOBOS:"blur",HEAT:"brightness"},d=document.querySelector(".big-picture"),u=d.querySelector("img"),m=d.querySelector(".likes-count"),v=d.querySelector(".social__caption"),p=d.querySelector(".comments-count"),y=d.querySelector(".social__comments"),g=d.querySelector(".social__comment-count"),L=d.querySelector(".comments-loader"),h=document.querySelector("#social__comment").content.querySelector(".social__comment");let S={},E=1;const q=()=>{const e=5*E++,t=5*E,r=S.slice(e,t),o=r.length+e,n=p.textContent;g.textContent=`${o} из ${n} комментариев`,f(r),S.length<=t&&(p.textContent=S.length,L.removeEventListener("click",q),L.classList.toggle("hidden",!0))},f=e=>{const t=document.createDocumentFragment();e.forEach((({avatar:e,name:r,message:o})=>{const n=h.cloneNode(!0);n.querySelector(".social__picture").src=e,n.querySelector(".social__picture").alt=r,n.querySelector(".social__text").innerText=o,t.appendChild(n)})),y.appendChild(t)},k=d.querySelector(".big-picture__cancel"),b=e=>{const t=(r=(e=>{const t=e.target;return void 0!==t.dataset.photoId?t.dataset.photoId:t.parentNode.dataset.photoId})(e),o().find((e=>e.id===parseInt(r))));var r;t&&(({url:e,likes:t,description:r,comments:o})=>{u.src=e,m.textContent=t,v.textContent=r,S=o,p.textContent=S.length,y.innerHTML="",E=0,q(),S.length<=5?L.classList.toggle("hidden",!0):(L.addEventListener("click",q),L.classList.toggle("hidden",!1))})(t)},C=e=>{b(e),d.classList.remove("hidden"),document.body.classList.add("modal-open"),k.addEventListener("click",x),document.addEventListener("keydown",w)},x=()=>{d.classList.add("hidden"),document.body.classList.remove("modal-open"),k.removeEventListener("click",x),document.removeEventListener("keydown",w)},w=t=>{e(t)&&(t.preventDefault(),x())},$=document.querySelector(".pictures"),D=document.querySelector("#picture").content.querySelector("a.picture"),I=document.querySelector(".pictures"),T=(e,t,r)=>{e.target&&e.target.classList.contains(t)&&(e.preventDefault(),r(e))},A=e=>{const t=document.createDocumentFragment();e.forEach((e=>t.appendChild((e=>{const t=D.cloneNode(!0);return t.dataset.photoId=e.id,t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__comments").innerText=e.comments.length,t.querySelector(".picture__likes").innerText=e.likes,t})(e)))),$.appendChild(t),I.addEventListener("click",(e=>{T(e,"picture__img",C)})),I.addEventListener("keydown",(e=>{T(e,"picture",V)}))},V=e=>{(e=>"Enter"===e.key)(e)&&(e.preventDefault(),C(e))},N=document.querySelector(".img-upload__preview img"),O=document.querySelector(".scale__control--value"),F=document.querySelector(".img-upload__effect-level"),H=document.querySelector(".effect-level__value");let U="none",j="",R="";const M=(e,t)=>{e.style=t},P=(e,t)=>{const r=t/100;O.value=t+"%",j=`transform: scale(${r});`,M(e,j+R)},B=()=>{let e=t(O);e+25<=100&&(e+=25,P(N,e))},W=()=>{let e=t(O);e-25>=25&&(e-=25,P(N,e))},z=()=>{G(),F.classList.add("hidden"),R="",M(N,j+R)},G=()=>{(()=>{const e=[];return document.querySelectorAll(".effects__radio").forEach((t=>e.push(t.value))),e})().forEach((e=>{const t=c+e;N.classList.toggle(t,!1)}))},J=e=>{if(e.target&&e.target.matches('input[type="radio"]')){if(G(),U=e.target.value,"none"===U)return void z();const t=c+U;K(U),N.classList.add(t),F.classList.toggle("hidden",!1)}},K=e=>{F.noUiSlider.updateOptions(i[e.toUpperCase()])},Q=document.querySelector(".img-upload__form"),X=document.querySelector(".text__hashtags"),Y=document.querySelector(".text__description"),Z=e=>{((e="",t=0)=>e.length<=t)(e.target.value,140)?(e.target.setCustomValidity(""),Y.classList.remove("border--error")):(e.target.setCustomValidity("Комментарий не может быть больше 140 символов"),Y.classList.add("border--error")),e.target.reportValidity()},ee=e=>n.test(e),te=e=>{const t=e.target.value.split(" ").filter((e=>""!==e)),r=t.length>5,o=!t.every(ee),n=!(e=>{const t=e.map((e=>e.toLowerCase())),r=new Set(t);return e.length===r.size})(t);switch(!0){case o:e.target.setCustomValidity("Хэштег должен начинаться с # и состоять из букв и чисел,\nи не может содержать пробелы, спецсимволы (#, @, $ и т. п.), \nсимволы пунктуации (тире, дефис, запятая и т. п.), эмодзи и т.д"),X.classList.add(s);break;case r:e.target.setCustomValidity("Максимальное колличество хэштегов 5"),X.classList.add(s);break;case n:e.target.setCustomValidity("Хэштег должен быть уникальным."),X.classList.add(s);break;default:e.target.setCustomValidity(""),X.classList.remove(s)}e.target.reportValidity()},re=document.querySelector("#upload-file"),oe=document.querySelector(".img-upload__preview img"),ne=document.querySelector(".img-upload__overlay"),ce=document.querySelector("#upload-cancel"),se=document.querySelector(".img-upload__form"),ae=document.querySelector(".scale__control--smaller"),ie=document.querySelector(".scale__control--bigger"),le=t=>{e(t)&&(t.preventDefault(),Y!==document.activeElement&&X!==document.activeElement&&de())},de=()=>{ne.classList.add("hidden"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",le),ce.removeEventListener("click",de),ae.removeEventListener("click",W),ie.removeEventListener("click",B),se.removeEventListener("change",J),Y.removeEventListener("input",Z),X.removeEventListener("input",te),re.value="",Y.value="",X.value="",Y.classList.remove("border--error"),X.classList.remove("border--error"),F.noUiSlider.destroy()},ue=document.querySelector("#success").content.querySelector(".success"),me=document.querySelector("#error").content.querySelector(".error"),ve=document.querySelector("#alert-message").content.querySelector(".alert-message"),pe=t=>{e(t)&&(t.preventDefault(),ge())},ye=e=>{e.target.classList.contains("success")&&ge()},ge=()=>{const e=document.querySelector(".success");e.querySelector(".success__button").removeEventListener("click",ge),e.removeEventListener("click",ye),document.removeEventListener("keydown",pe),e.remove()},Le=t=>{e(t)&&(t.preventDefault(),he())},_e=e=>{e.target.classList.contains("error")&&he()},he=()=>{const e=document.querySelector(".error");e.querySelector(".error__button").removeEventListener("click",he),e.removeEventListener("click",_e),document.removeEventListener("keydown",Le),e.remove()},Se=document.querySelector("#filter-default"),Ee=document.querySelector("#filter-random"),qe=document.querySelector("#filter-discussed"),fe=(e,t)=>e.slice().sort(t),ke=()=>_.random(0,2)-1,be=(e,t)=>t.comments.length-e.comments.length,Ce=e=>{document.querySelectorAll(".img-filters__button").forEach((e=>{e.classList.toggle("img-filters__button--active",!1)})),e.classList.add("img-filters__button--active"),document.querySelectorAll(".picture").forEach((e=>{e.remove()}))},xe=()=>{const e=o();Ce(Se),A(e)},we=()=>{const e=o(),t=fe(e,ke).slice(0,10);Ce(Ee),A(t)},$e=()=>{const e=o(),t=fe(e,be);Ce(qe),A(t)};var De,Ie;De=e=>{r=e,A(e),document.querySelector(".img-filters").classList.remove("img-filters--inactive"),Se.addEventListener("click",_.throttle(xe,500)),Ee.addEventListener("click",_.throttle(we,500)),qe.addEventListener("click",_.throttle($e,500))},Ie=()=>{(e=>{const t=ve.cloneNode(!0);t.innerText="Ошибка загрузки данных.\nПожалуйста обратитесь к администратору сайта или попробуйте позже.",document.body.appendChild(t),setTimeout((()=>{t.remove()}),5e3)})()},fetch("https://22.javascript.pages.academy/kekstagram/data").then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((e=>{De(e)})).catch((e=>{Ie()})),re.addEventListener("change",(()=>{(()=>{const e=re.files[0],t=e.name.toLowerCase();if(a.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{oe.src=t.result})),t.readAsDataURL(e),t.removeEventListener("load",(()=>{oe.src=t.result}))}})(),ne.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",le),ce.addEventListener("click",de),ae.addEventListener("click",W),ie.addEventListener("click",B),se.addEventListener("change",J),Y.addEventListener("input",Z),X.addEventListener("input",te),P(N,100),noUiSlider.create(F,{range:{min:0,max:1},start:1,step:.1,connect:"lower",format:{to:e=>Number.isInteger(e)?e.toFixed(0):e.toFixed(1),from:e=>parseFloat(e)}}),F.noUiSlider.on("update",((e,t)=>{H.value=e[t],(()=>{let e="";"marvin"===U?e="%":"phobos"===U&&(e="px"),R=`filter: ${l[U.toUpperCase()]}(${H.value}${e})`,M(N,j+R)})()})),z()})),((e,t)=>{Q.addEventListener("submit",(r=>{r.preventDefault(),((e,t,r,o)=>{fetch("https://22.javascript.pages.academy/kekstagram",{method:"POST",body:t}).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((()=>r())).catch((e=>{o(e)}))})(0,new FormData(r.target),e,t),de()}))})((()=>{const e=ue.cloneNode(!0);document.body.appendChild(e),document.querySelector(".success__button").addEventListener("click",ge),e.addEventListener("click",ye),document.addEventListener("keydown",pe)}),(()=>{const e=me.cloneNode(!0);document.body.appendChild(e),e.addEventListener("click",_e),document.querySelector(".error__button").addEventListener("click",he),document.addEventListener("keydown",Le)}))})();
//# sourceMappingURL=main.bundle.js.map